<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Expense Splitter</title>
<style>
  :root{--bg:#0f1724;--card:#0b1220;--accent:#7ad1ff;--muted:#9aa4b2;--radius:12px}
  *{box-sizing:border-box}
  body{margin:0;min-height:100vh;font-family:Inter,system-ui,Roboto,Arial;background:linear-gradient(180deg,#071026,#081428);color:#e6eef8;display:flex;align-items:center;justify-content:center;padding:24px}
  .wrap{width:100%;max-width:780px;display:grid;grid-template-columns:1fr 360px;gap:20px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:16px;border-radius:var(--radius);border:1px solid rgba(255,255,255,0.04)}
  h1{margin:0 0 8px 0;font-size:1.2rem}
  input,button,select{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;outline:none}
  .row{display:flex;gap:8px;margin-top:8px}
  .btn{background:var(--accent);border:0;padding:8px 12px;border-radius:8px;color:#022;cursor:pointer;font-weight:700}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  ul.participants{list-style:none;padding:0;margin-top:10px;max-height:300px;overflow:auto}
  li.part{display:flex;justify-content:space-between;gap:10px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.01);margin-bottom:8px;align-items:center}
  .muted{color:var(--muted);font-size:0.9rem}
  .result{margin-top:12px}
  .small{font-size:0.85rem;color:var(--muted)}
  @media (max-width:780px){.wrap{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="wrap">
    <section class="card">
      <h1>Expense Splitter</h1>
      <div class="small muted">Split bills evenly or with custom shares. Save & reuse.</div>

      <div style="margin-top:12px">
        <label class="small">Total Bill</label>
        <div class="row">
          <input id="totalBill" type="number" step="0.01" placeholder="0.00" />
          <select id="currency"><option value="₹">₹ INR</option><option value="$">$ USD</option><option value="€">€ EUR</option></select>
        </div>

        <div class="row" style="margin-top:8px">
          <input id="addName" placeholder="Participant name (e.g., Aisha)" />
          <button class="btn" id="addPerson">Add</button>
        </div>

        <ul class="participants" id="partsList" aria-live="polite"></ul>

        <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
          <input id="tip" type="number" step="1" placeholder="Tip % (optional)" style="width:120px" />
          <label class="small muted" style="margin-left:6px">Round up</label>
          <input id="roundUp" type="checkbox" style="width:18px;height:18px;margin-left:6px" />
        </div>

        <div style="margin-top:12px" class="row">
          <button class="btn" id="calculate">Calculate Split</button>
          <button class="btn ghost" id="clearData">Clear</button>
        </div>

        <div class="result" id="resultArea"></div>
      </div>
    </section>

    <aside class="card">
      <h3>Summary</h3>
      <div id="summary" class="small muted">No participants yet.</div>
      <div style="margin-top:12px" id="historyArea"></div>
    </aside>
  </div>

<script>
(function(){
  const LS = 'expense_split_v1';
  const partsList = document.getElementById('partsList');
  const addName = document.getElementById('addName');
  const addPerson = document.getElementById('addPerson');
  const totalBill = document.getElementById('totalBill');
  const tipEl = document.getElementById('tip');
  const roundUpEl = document.getElementById('roundUp');
  const calculateBtn = document.getElementById('calculate');
  const resultArea = document.getElementById('resultArea');
  const summary = document.getElementById('summary');
  const clearData = document.getElementById('clearData');
  const currency = document.getElementById('currency');
  const historyArea = document.getElementById('historyArea');

  let participants = load().participants || [];

  function save(){
    localStorage.setItem(LS, JSON.stringify({participants}));
    renderParticipants();
    renderSummary();
  }
  function load(){ try { return JSON.parse(localStorage.getItem(LS) || "{}"); } catch(e){ return {}; } }

  function renderParticipants(){
    partsList.innerHTML = '';
    if (participants.length === 0){ partsList.innerHTML = '<li class="small muted">No participants. Add names above.</li>'; return; }
    participants.forEach((p, i) => {
      const li = document.createElement('li'); li.className='part';
      const left = document.createElement('div'); left.style.display='flex'; left.style.flexDirection='column';
      left.innerHTML = `<strong>${escapeHtml(p.name)}</strong><span class="small muted">Share: ${p.share || 1}</span>`;
      const right = document.createElement('div');
      const inc = document.createElement('button'); inc.className='btn ghost'; inc.textContent='+';
      inc.addEventListener('click', ()=>{ p.share = (p.share||1) + 1; save(); });
      const dec = document.createElement('button'); dec.className='btn ghost'; dec.textContent='-';
      dec.addEventListener('click', ()=>{ p.share = Math.max(1,(p.share||1)-1); save(); });
      const rem = document.createElement('button'); rem.className='btn'; rem.textContent='Remove';
      rem.addEventListener('click', ()=>{ if(confirm('Remove participant?')) { participants.splice(i,1); save(); }});
      right.appendChild(inc); right.appendChild(dec); right.appendChild(rem);
      li.appendChild(left); li.appendChild(right); partsList.appendChild(li);
    });
  }

  function renderSummary(){
    if (participants.length === 0){ summary.textContent = 'No participants yet.'; return; }
    summary.innerHTML = `Participants: <strong>${participants.length}</strong> · Total shares: <strong>${participants.reduce((s,p)=>s+(p.share||1),0)}</strong>`;
  }

  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])); }

  addPerson.addEventListener('click', ()=>{
    const name = addName.value.trim();
    if (!name) { alert('Enter a name'); return; }
    participants.push({name, share:1});
    addName.value=''; save();
  });
  addName.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ addPerson.click(); }});

  calculateBtn.addEventListener('click', ()=>{
    const bill = parseFloat(totalBill.value);
    if (isNaN(bill) || bill <= 0){ alert('Enter a valid bill amount'); return; }
    if (participants.length===0){ alert('Add at least one participant'); return; }
    const tip = parseFloat(tipEl.value) || 0;
    const roundUp = roundUpEl.checked;
    const totalTip = (tip/100) * bill;
    const grand = bill + totalTip;
    const totalShares = participants.reduce((s,p)=>s+(p.share||1),0);
    // compute each
    const breakdown = participants.map(p => {
      const shareAmountRaw = (grand * ( (p.share||1) / totalShares ));
      const amount = roundUp ? Math.ceil(shareAmountRaw*100)/100 : Math.round(shareAmountRaw*100)/100;
      return {name:p.name,share:p.share||1, amount};
    });
    // adjust rounding diff
    const sum = breakdown.reduce((s,b)=>s+b.amount,0);
    let diff = Math.round((grand - sum) * 100)/100;
    if (diff !== 0){
      // distribute diff starting from first
      for (let i=0;i<breakdown.length && Math.abs(diff) >= 0.001;i++){
        breakdown[i].amount = Math.round((breakdown[i].amount + Math.sign(diff)*0.01)*100)/100;
        diff = Math.round((grand - breakdown.reduce((s,b)=>s+b.amount,0))*100)/100;
      }
    }
    // show
    resultArea.innerHTML = `<div class="small muted">Bill ${currency.value}${bill.toFixed(2)} · Tip ${tip}% · Total ${currency.value}${grand.toFixed(2)}</div>`;
    const ul = document.createElement('ul'); ul.style.listStyle='none'; ul.style.padding='0'; ul.style.marginTop='8px';
    breakdown.forEach(b => {
      const li = document.createElement('li'); li.style.display='flex'; li.style.justifyContent='space-between'; li.style.padding='8px'; li.style.borderRadius='8px'; li.style.marginBottom='8px'; li.style.background='rgba(255,255,255,0.01)';
      li.innerHTML = `<div><strong>${escapeHtml(b.name)}</strong><div class="small muted">Share: ${b.share}</div></div><div><strong>${currency.value}${b.amount.toFixed(2)}</strong></div>`;
      ul.appendChild(li);
    });
    resultArea.appendChild(ul);
    // save history
    saveSplit({timestamp:Date.now(),bill,tip,currency:currency.value,breakdown});
    renderHistory();
  });

  function saveSplit(obj){
    const hist = load().history || [];
    hist.unshift(obj);
    localStorage.setItem(LS, JSON.stringify({participants, history: hist.slice(0,10)}));
  }

  function renderHistory(){
    const hist = (load().history || []);
    historyArea.innerHTML = '';
    if (hist.length===0) { historyArea.innerHTML = '<div class="small muted">No recent splits</div>'; return; }
    historyArea.innerHTML = hist.slice(0,5).map(h=>{
      const d = new Date(h.timestamp); return `<div class="small"><strong>${d.toLocaleString()}</strong> · ${h.currency}${h.bill.toFixed(2)} · Tip ${h.tip}%</div>`;
    }).join('');
  }

  clearData.addEventListener('click', ()=>{ if(confirm('Clear participants and history?')){ participants=[]; localStorage.removeItem(LS); renderParticipants(); renderSummary(); renderHistory(); resultArea.innerHTML=''; } });

  // initial load
  (function init(){
    const store = load();
    participants = store.participants || participants;
    renderParticipants(); renderSummary(); renderHistory();
  })();
})();
</script>
</body>
</html>
